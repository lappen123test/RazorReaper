@page "/dino-prices"
@using Microsoft.AspNetCore.Components.Web

<div class="app-container">
    <RazorReaper.Components.Shared.SharedNavbar />

    <main class="main-content">
        <header class="page-header">
            <h1 class="page-title">Gen2 Mutagen Dino Prices</h1>
            <p class="page-subtitle">Browse ARK dinos with Gen2 mutagen pricing by category</p>
        </header>

        <!-- Sticky Search Bar -->
        <div class="search-bar-container">
            <div class="search-input-wrapper">
                <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
                <input
                    type="text"
                    class="search-input"
                    placeholder="Search dinos by name..."
                    @bind="searchQuery"
                    @bind:event="oninput"
                />
                @if (!string.IsNullOrWhiteSpace(searchQuery))
                {
                    <button class="clear-search-btn" @onclick="ClearSearch">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                        </svg>
                    </button>
                }
            </div>
            @if (filteredCount < totalCount && !string.IsNullOrWhiteSpace(searchQuery))
            {
                <div class="search-results-info">
                    Showing @filteredCount of @totalCount dinos
                </div>
            }
        </div>

        <!-- Category Sections -->
        <div class="dino-categories-container">
            @foreach (var category in categories)
            {
                var categoryDinos = GetFilteredDinosByCategory(category);

                @if (categoryDinos.Any())
                {
                    <div class="category-section">
                        <div class="category-header" @onclick="() => ToggleCategory(category)">
                            <div class="category-header-left">
                                <div class="category-icon @GetCategoryColorClass(category)">
                                    @GetCategoryIcon(category)
                                </div>
                                <div>
                                    <h2 class="category-title">@category</h2>
                                    <p class="category-count">@categoryDinos.Count() dinos</p>
                                </div>
                            </div>
                            <svg class="category-toggle-icon @(expandedCategories.Contains(category) ? "expanded" : "")"
                                 fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </div>

                        @if (expandedCategories.Contains(category))
                        {
                            <div class="dino-grid">
                                @foreach (var dino in categoryDinos)
                                {
                                    <div class="dino-card">
                                        <div class="dino-card-header">
                                            <h3 class="dino-name">@dino.Name</h3>
                                            <span class="dino-price">@dino.Price</span>
                                        </div>
                                        @if (!string.IsNullOrWhiteSpace(dino.Description))
                                        {
                                            <p class="dino-description">@dino.Description</p>
                                        }
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            }

            @if (filteredCount == 0)
            {
                <div class="no-results">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                    </svg>
                    <h3>No dinos found</h3>
                    <p>Try adjusting your search query</p>
                </div>
            }
        </div>
    </main>
</div>

@code {
    private string searchQuery = "";
    private HashSet<string> expandedCategories = new HashSet<string>();
    private List<string> categories = new List<string> { "PVP", "RAID", "DEFENSE", "SUPPORT", "FARMER", "OTHER" };

    private List<DinoPrice> allDinos = new List<DinoPrice>();
    private int totalCount => allDinos.Count;
    private int filteredCount => GetFilteredDinos().Count();

    protected override void OnInitialized()
    {
        // Initialize with dummy data - replace with your actual dinos
        allDinos = new List<DinoPrice>
        {
            // PVP Category
            new DinoPrice { Name = "Rex", Category = "PVP", Price = "2,500 Mutagen", Description = "Powerful combat mount for PvP battles" },
            new DinoPrice { Name = "Giganotosaurus", Category = "PVP", Price = "5,000 Mutagen", Description = "Ultimate raid boss killer" },
            new DinoPrice { Name = "Velonasaur", Category = "PVP", Price = "1,800 Mutagen", Description = "Anti-air and ground combat" },

            // RAID Category
            new DinoPrice { Name = "Arthropluera", Category = "RAID", Price = "1,200 Mutagen", Description = "Acid damage for structures" },
            new DinoPrice { Name = "Stegosaurus", Category = "RAID", Price = "900 Mutagen", Description = "Soaking damage for raids" },
            new DinoPrice { Name = "Tek Stryder", Category = "RAID", Price = "3,500 Mutagen", Description = "Advanced raiding capabilities" },

            // DEFENSE Category
            new DinoPrice { Name = "Carnotaurus", Category = "DEFENSE", Price = "800 Mutagen", Description = "Base defense guard" },
            new DinoPrice { Name = "Brontosaurus", Category = "DEFENSE", Price = "1,500 Mutagen", Description = "Area defense with high HP" },
            new DinoPrice { Name = "Plant Species X", Category = "DEFENSE", Price = "600 Mutagen", Description = "Automated turret plant" },

            // SUPPORT Category
            new DinoPrice { Name = "Argentavis", Category = "SUPPORT", Price = "1,100 Mutagen", Description = "Flying transport and resource carrier" },
            new DinoPrice { Name = "Daedon", Category = "SUPPORT", Price = "1,400 Mutagen", Description = "Healing support for tames" },
            new DinoPrice { Name = "Yutyrannus", Category = "SUPPORT", Price = "2,200 Mutagen", Description = "Courage roar buff for team" },

            // FARMER Category
            new DinoPrice { Name = "Ankylosaurus", Category = "FARMER", Price = "700 Mutagen", Description = "Metal and flint farming" },
            new DinoPrice { Name = "Doedicurus", Category = "FARMER", Price = "650 Mutagen", Description = "Stone gathering specialist" },
            new DinoPrice { Name = "Mammoth", Category = "FARMER", Price = "750 Mutagen", Description = "Wood and thatch collection" },

            // OTHER Category
            new DinoPrice { Name = "Otter", Category = "OTHER", Price = "300 Mutagen", Description = "Thermal insulation companion" },
            new DinoPrice { Name = "Shinehorn", Category = "OTHER", Price = "400 Mutagen", Description = "Light source for dark areas" },
            new DinoPrice { Name = "Bulbdog", Category = "OTHER", Price = "350 Mutagen", Description = "Charge light pet" }
        };

        // Expand all categories by default
        expandedCategories = new HashSet<string>(categories);
    }

    private void ClearSearch()
    {
        searchQuery = "";
    }

    private void ToggleCategory(string category)
    {
        if (expandedCategories.Contains(category))
        {
            expandedCategories.Remove(category);
        }
        else
        {
            expandedCategories.Add(category);
        }
    }

    private IEnumerable<DinoPrice> GetFilteredDinos()
    {
        if (string.IsNullOrWhiteSpace(searchQuery))
            return allDinos;

        return allDinos.Where(d => d.Name.Contains(searchQuery, StringComparison.OrdinalIgnoreCase));
    }

    private IEnumerable<DinoPrice> GetFilteredDinosByCategory(string category)
    {
        return GetFilteredDinos().Where(d => d.Category == category);
    }

    private string GetCategoryColorClass(string category)
    {
        return category.ToLower() switch
        {
            "pvp" => "icon-pvp",
            "raid" => "icon-raid",
            "defense" => "icon-defense",
            "support" => "icon-support",
            "farmer" => "icon-farmer",
            "other" => "icon-other",
            _ => "icon-default"
        };
    }

    private MarkupString GetCategoryIcon(string category)
    {
        return category.ToUpper() switch
        {
            "PVP" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path d=""M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"" />
            </svg>"),
            "RAID" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path fill-rule=""evenodd"" d=""M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z"" clip-rule=""evenodd"" />
            </svg>"),
            "DEFENSE" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path fill-rule=""evenodd"" d=""M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"" clip-rule=""evenodd"" />
            </svg>"),
            "SUPPORT" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path d=""M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"" />
            </svg>"),
            "FARMER" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path fill-rule=""evenodd"" d=""M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z"" clip-rule=""evenodd"" />
            </svg>"),
            "OTHER" => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path fill-rule=""evenodd"" d=""M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"" clip-rule=""evenodd"" />
            </svg>"),
            _ => new MarkupString(@"<svg fill=""currentColor"" viewBox=""0 0 20 20"">
                <path d=""M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"" />
            </svg>")
        };
    }

    private class DinoPrice
    {
        public string Name { get; set; } = "";
        public string Category { get; set; } = "";
        public string Price { get; set; } = "";
        public string Description { get; set; } = "";
    }
}
